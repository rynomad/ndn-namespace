<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: InterestHandler.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: InterestHandler.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>var io = require("ndn-io")
  , Policy = require("./policy.js");

var CODE = {
  CONTENTRECEIVED: 0
  , STORAGEREQUESTREJECTED: 1
  , DATANOTFOUND: 2
};

/**InterestHandler has methods to interperet and respond to interest messages
 *@constructor
 *@param {Object} face the ndn.Face object for connection to local or remote forwarder
 *@param {Database} database a {@link Database} instance
 *@param {Object} policy a policy object
 *@returns {InterestHandler} a new InterestHandler instance
 */
function InterestHandler (face, database, policy){
  this.policy = new Policy(policy);
  this.face = face;
  this.database = database;
  this.ndn = database.ndn;
  this.io = new io(face, database.nameTree);
  io.installFace(face, this.onInterest);
  return this;
}

/** negative acknowledgement (noop)
 */
InterestHandler.prototype.nack = function(interest, code){
  //send nack packet
  //var nack = "dummy";
  //self.face.transport.send(nack);
};

/** acknowledgement (noop)
 */
InterestHandler.prototype.ack = function(interest, code){
  //send storage ack
  var ack = "dummy";
  this.face.transport.send(ack);
};

/** determine if the interest is a storage request
 *@param {Interest} interest the ndn.Interest object
 *@returns {Boolean}
 */
InterestHandler.prototype.isStorageRequest = function(interest){
  //return true or false
  return false;
};

/** parse a storage request
 *@param {Interest} interest the NDN.Interest object of the STORAGE REQUEST
 *@returns {Interest} an interest for the first segment of the data to store
 */
InterestHandler.prototype.parseStorageRequest = function(interest){
  //return {uri, finalBlockId}
  return false;
};

/**Interest handler main functino
 *@param {Interest} interest the ndn.Interest Object
 *@returns {this} for chaining
 */
InterestHandler.prototype.onInterest = function(interest){
  var self = this;
  if (this.isStorageRequest(interest)){
    var request = this.parseStorageRequest(interest);
    if (this.policy.acceptStorageRequest(request)){
      return io.fetchAllSegments(request.uri, function(data, element){
        self.database.insert(element, new self.database.contentStore.EntryClass(element, data), function(){
          if (self.ndn.DataUtils.arraysEqual(data.getMetaInfo().getFinalBlockID, request.finalBlockID)){
            self.ack(interest, CODE.CONTENTRECEIVED);
          }
        });
      });
    } else {
      return this.nack(interest, CODE.STORAGEREQUESTREJECTED);
    }
  } else {
    this.database.check(interest, function(element){
      if (!element){
        self.nack(interest, CODE.DATANOTFOUND);
      } else{
        self.face.transport.send(element);
      }
    });
  }
  return this;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Externals</h3><ul><li><a href="external-ContentStore.html">ContentStore</a></li></ul><h3>Classes</h3><ul><li><a href="Database.html">Database</a></li><li><a href="InterestHandler.html">InterestHandler</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Wed Jul 30 2014 16:00:47 GMT-0600 (MDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
